{% extends "base.html" %}

{% block title %}Demo - Filum.ai Pain Point Agent{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="text-primary">
                <i class="fas fa-play-circle me-2"></i>
                Demo - Ví dụ Pain Point Analysis
            </h2>
            <p class="text-muted">
                Thử ngay các ví dụ pain point thực tế để xem cách AI Agent analysis và recommend solution
            </p>
        </div>
    </div>

    <!-- Demo Examples -->
    <div class="row">
        <div class="col-lg-4 mb-4">
            <div class="card h-100 shadow-sm demo-card" 
                 data-pain-point="Customer thường xuyên phàn nàn về thời gian chờ đợi quá lâu khi liên hệ hỗ trợ. Trung bình mỗi cuộc gọi phải chờ 15-20 phút mới có nhân viên trả lời. Điều này gây ra sự bức xúc và một số customer đã chuyển sang đối thủ cạnh tranh."
                 data-context="Company có 100 nhân viên support nhưng lượng ticket tăng 200% trong 6 tháng qua"
                 data-industry="ecommerce"
                 data-company-size="medium"
                 data-urgency="high"
                 data-budget="medium">
                <div class="card-header bg-danger text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-headset me-2"></i>
                        Hỗ trợ customer quá tải
                    </h5>
                </div>
                <div class="card-body">
                    <p class="card-text">
                        <strong>Tình huống:</strong> E-commerce với 500 nhân viên, lượng ticket hỗ trợ tăng 200% 
                        trong 6 tháng qua khiến customer phải chờ 15-20 phút mới được trả lời.
                    </p>
                    <p class="card-text">
                        <strong>Tác động:</strong> Customer bức xúc, chuyển sang đối thủ cạnh tranh.
                    </p>
                </div>
                <div class="card-footer">
                    <button class="btn btn-danger w-100 run-demo-btn">
                        <i class="fas fa-play me-2"></i>
                        Run analysis
                    </button>
                </div>
            </div>
        </div>

        <div class="col-lg-4 mb-4">
            <div class="card h-100 shadow-sm demo-card"
                 data-pain-point="Company không hiểu rõ nhu cầu và hành vi customer. Các quyết định về sản phẩm và marketing thường dựa trên cảm tính thay vì dữ liệu customer thực tế. Thiếu insight để cải thiện customer experience và tăng độ hài lòng."
                 data-context="Có nhiều dữ liệu customer nhưng chưa biết cách analysis và khai thác hiệu quả"
                 data-industry="retail"
                 data-company-size="large"
                 data-urgency="medium"
                 data-budget="high">
                <div class="card-header bg-warning text-dark">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-bar me-2"></i>
                        Thiếu Customer Insight
                    </h5>
                </div>
                <div class="card-body">
                    <p class="card-text">
                        <strong>Tình huống:</strong> Company bán lẻ lớn với > 1000 nhân viên có nhiều dữ liệu 
                        customer nhưng không biết cách analysis để có insight.
                    </p>
                    <p class="card-text">
                        <strong>Tác động:</strong> Quyết định dựa trên cảm tính, thiếu insight để cải thiện CX.
                    </p>
                </div>
                <div class="card-footer">
                    <button class="btn btn-warning w-100 run-demo-btn">
                        <i class="fas fa-play me-2"></i>
                        Run analysis
                    </button>
                </div>
            </div>
        </div>

        <div class="col-lg-4 mb-4">
            <div class="card h-100 shadow-sm demo-card"
                 data-pain-point="Khó khăn trong việc thu thập và tổng hợp feedback từ nhiều kênh khác nhau (website, app, social media, email, phone). Feedback bị phân tán và không có cách thức analysis thống nhất để hiểu tổng quan về voice of customer."
                 data-context="Feedback đến từ 5-6 kênh khác nhau, mỗi kênh có format và cách lưu trữ riêng"
                 data-industry="banking"
                 data-company-size="large"
                 data-urgency="medium"
                 data-budget="enterprise">
                <div class="card-header bg-info text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-comments me-2"></i>
                        Thu thập Voice of Customer
                    </h5>
                </div>
                <div class="card-body">
                    <p class="card-text">
                        <strong>Tình huống:</strong> Ngân hàng lớn với feedback từ 5-6 kênh khác nhau 
                        (website, app, social, email, phone) nhưng bị phân tán.
                    </p>
                    <p class="card-text">
                        <strong>Tác động:</strong> Không có cái nhìn tổng quan về voice of customer.
                    </p>
                </div>
                <div class="card-footer">
                    <button class="btn btn-info w-100 run-demo-btn">
                        <i class="fas fa-play me-2"></i>
                        Run analysis
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h4 class="card-title mb-0">
                        <i class="fas fa-lightbulb me-2"></i>
                        Results analysis Demo
                    </h4>
                </div>
                <div class="card-body">
                    <div id="demoResults">
                        <div class="text-center text-muted py-5">
                            <i class="fas fa-mouse-pointer fa-3x mb-3 opacity-50"></i>
                            <h5>Chọn một ví dụ để xem results analysis</h5>
                            <p>Nhấn button "Run analysis" trên bất kỳ ví dụ nào ở trên</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Additional Examples -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card border-0 bg-light">
                <div class="card-header bg-secondary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-plus-circle me-2"></i>
                        Ví dụ khác
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card border quick-example-card"
                                 data-pain-point="Nhân viên bán hàng không có đủ thông tin về lịch sử mua hàng và preferences của customer khi tương tác, dẫn đến trải nghiệm không nhất quán và bỏ lỡ cơ hội cross-sell/up-sell."
                                 data-context="Dữ liệu customer lưu trong nhiều hệ thống khác nhau"
                                 data-industry="retail"
                                 data-company-size="medium"
                                 data-urgency="medium">
                                <div class="card-body p-3">
                                    <h6 class="card-title">
                                        <i class="fas fa-user-circle me-2"></i>
                                        360° Customer View
                                    </h6>
                                    <p class="card-text small text-muted">
                                        Nhân viên thiếu thông tin customer toàn diện
                                    </p>
                                    <button class="btn btn-outline-primary btn-sm quick-demo-btn">
                                        Analysis nhanh
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card border quick-example-card"
                                 data-pain-point="Quy trình xử lý khiếu nại thủ công, mất thời gian và dễ sai sót. Customer phải chờ đợi lâu để được xử lý và thường phải giải thích lại vấn đề nhiều lần cho nhiều nhân viên khác nhau."
                                 data-context="Xử lý 200-300 khiếu nại mỗi ngày bằng email và spreadsheet"
                                 data-industry="telecom"
                                 data-company-size="large"
                                 data-urgency="high">
                                <div class="card-body p-3">
                                    <h6 class="card-title">
                                        <i class="fas fa-cogs me-2"></i>
                                        Tự động hóa quy trình
                                    </h6>
                                    <p class="card-text small text-muted">
                                        Xử lý khiếu nại thủ công, chậm và sai sót
                                    </p>
                                    <button class="btn btn-outline-primary btn-sm quick-demo-btn">
                                        Analysis nhanh
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Handle main demo buttons
document.querySelectorAll('.run-demo-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const card = this.closest('.demo-card');
        runDemoAnalysis(card);
    });
});

// Handle quick demo buttons  
document.querySelectorAll('.quick-demo-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const card = this.closest('.quick-example-card');
        runDemoAnalysis(card);
    });
});

function runDemoAnalysis(card) {
    const data = {
        pain_point: card.dataset.painPoint,
        context: card.dataset.context || '',
        industry: card.dataset.industry || '',
        company_size: card.dataset.companySize || '',
        urgency: card.dataset.urgency || '',
        budget_range: card.dataset.budget || ''
    };
    
    // Show loading
    const resultsContainer = document.getElementById('demoResults');
    resultsContainer.innerHTML = `
        <div class="text-center py-4">
            <div class="spinner-border text-primary mb-3" role="status">
                <span class="visually-hidden">Đang analysis...</span>
            </div>
            <h5>AI Agent đang analysis...</h5>
            <p class="text-muted">Đang tìm solution phù hợp từ knowledge base</p>
        </div>
    `;
    
    // Create form data
    const formData = new FormData();
    Object.keys(data).forEach(key => {
        if (data[key]) formData.append(key, data[key]);
    });
    
    // Submit analysis
    fetch('/analyze', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(result => {
        displayDemoResults(result, data);
    })
    .catch(error => {
        console.error('Error:', error);
        resultsContainer.innerHTML = `
            <div class="alert alert-danger">
                <h6><i class="fas fa-exclamation-triangle me-2"></i>Error analysis</h6>
                <p class="mb-0">Có error xảy ra khi analysis. Vui lòng thử lại.</p>
            </div>
        `;
    });
}

function displayDemoResults(result, originalData) {
    const container = document.getElementById('demoResults');
    
    let html = `
        <!-- Original Pain Point -->
        <div class="alert alert-light border-start border-primary border-3 mb-4">
            <h6 class="alert-heading">
                <i class="fas fa-file-alt me-2"></i>
                Pain Point được analysis
            </h6>
            <p class="mb-2"><strong>Mô tả:</strong> ${originalData.pain_point}</p>
            ${originalData.context ? `<p class="mb-2"><strong>Bối cảnh:</strong> ${originalData.context}</p>` : ''}
            <div class="row g-2 mt-2">
                ${originalData.industry ? `<div class="col-auto"><span class="badge bg-primary">${originalData.industry}</span></div>` : ''}
                ${originalData.company_size ? `<div class="col-auto"><span class="badge bg-info">${originalData.company_size}</span></div>` : ''}
                ${originalData.urgency ? `<div class="col-auto"><span class="badge bg-warning">${originalData.urgency}</span></div>` : ''}
            </div>
        </div>
        
        <!-- Analysis Summary -->
        <div class="alert alert-success border-0 mb-4">
            <h6 class="alert-heading">
                <i class="fas fa-check-circle me-2"></i>
                Pain Point Summary
            </h6>
            <p class="mb-2">${result.pain_point_summary}</p>
            <div class="progress mb-2" style="height: 6px;">
                <div class="progress-bar bg-success" role="progressbar" 
                     style="width: ${Math.round(result.confidence_score * 100)}%"></div>
            </div>
            <small class="text-muted">Confidence level: ${Math.round(result.confidence_score * 100)}%</small>
        </div>
    `;
    
    // Solutions
    if (result.recommended_solutions && result.recommended_solutions.length > 0) {
        html += `
            <h5 class="mb-3">
                <i class="fas fa-lightbulb me-2 text-success"></i>
                Solution được recommend (${result.recommended_solutions.length})
            </h5>
        `;
        
        result.recommended_solutions.forEach((solution, index) => {
            const confidenceColor = solution.confidence_score > 0.7 ? 'success' : 
                                   solution.confidence_score > 0.5 ? 'warning' : 'secondary';
            
            html += `
                <div class="card mb-3 border-start border-${confidenceColor} border-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h6 class="card-title text-${confidenceColor} mb-1">
                                    <span class="badge bg-${confidenceColor} me-2">${index + 1}</span>
                                    ${solution.name}
                                </h6>
                                <small class="text-muted">
                                    <i class="fas fa-layer-group me-1"></i>${solution.category}
                                </small>
                            </div>
                            <div class="text-end">
                                <div class="badge bg-${confidenceColor} fs-6">
                                    ${Math.round(solution.confidence_score * 100)}%
                                </div>
                            </div>
                        </div>
                        
                        <p class="card-text mb-3">${solution.description}</p>
                        
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-chart-line text-success me-2"></i>
                                    <div>
                                        <small class="text-muted d-block">Tác động dự kiến</small>
                                        <strong>${solution.expected_impact}</strong>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-clock text-info me-2"></i>
                                    <div>
                                        <small class="text-muted d-block">Độ phức tạp triển khai</small>
                                        <strong>${solution.implementation_effort}</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        ${solution.key_features && solution.key_features.length > 0 ? `
                            <div class="mb-3">
                                <small class="text-muted d-block mb-2">
                                    <i class="fas fa-star me-1"></i>
                                    <strong>Tính năng chính:</strong>
                                </small>
                                <div>
                                    ${solution.key_features.slice(0, 4).map(feature => 
                                        `<span class="badge bg-light text-dark me-1 mb-1 border">${feature}</span>`
                                    ).join('')}
                                    ${solution.key_features.length > 4 ? 
                                        `<span class="badge bg-secondary">+${solution.key_features.length - 4} khác</span>` : ''
                                    }
                                </div>
                            </div>
                        ` : ''}
                        
                        ${solution.use_cases && solution.use_cases.length > 0 ? `
                            <div class="mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-check-circle me-1"></i>
                                    <strong>Use cases phù hợp:</strong> 
                                    ${solution.use_cases.slice(0, 2).join(', ')}
                                    ${solution.use_cases.length > 2 ? '...' : ''}
                                </small>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        });
    }
    
    // Reasoning and Next Steps
    html += `
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="alert alert-info border-0">
                    <h6 class="alert-heading">
                        <i class="fas fa-brain me-2"></i>
                        Lý do analysis
                    </h6>
                    <p class="mb-0 small">${result.reasoning}</p>
                </div>
            </div>
            <div class="col-md-6">
                ${result.next_steps && result.next_steps.length > 0 ? `
                    <div class="alert alert-warning border-0">
                        <h6 class="alert-heading">
                            <i class="fas fa-tasks me-2"></i>
                            Bước tiếp theo recommend
                        </h6>
                        <ul class="mb-0 small ps-3">
                            ${result.next_steps.map(step => `<li>${step}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
            </div>
        </div>
    `;
    
    container.innerHTML = html;
    
    // Smooth scroll to results
    container.scrollIntoView({ behavior: 'smooth', block: 'start' });
}
</script>
{% endblock %}
